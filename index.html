<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NFGNB vs Enterobacterales — Respiratory AMR Surveillance 2013-2024</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<style>
:root {
    --bg: #0f172a;
    --bg2: #1e293b;
    --bg3: #334155;
    --text: #e2e8f0;
    --text2: #94a3b8;
    --accent1: #f43f5e;
    --accent2: #3b82f6;
    --accent3: #8b5cf6;
    --green: #22c55e;
    --amber: #f59e0b;
    --red: #ef4444;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
}
.container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }

/* Hero */
.hero {
    background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
    padding: 80px 0 60px;
    position: relative;
    overflow: hidden;
}
.hero::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at 30% 50%, rgba(244,63,94,0.08) 0%, transparent 50%),
                radial-gradient(circle at 70% 50%, rgba(59,130,246,0.08) 0%, transparent 50%);
    animation: pulse 8s ease-in-out infinite alternate;
}
@keyframes pulse { 0% { opacity: 0.5; } 100% { opacity: 1; } }
.hero-content { position: relative; z-index: 1; }
.hero h1 {
    font-size: 2.5rem;
    font-weight: 800;
    line-height: 1.2;
    margin-bottom: 16px;
    background: linear-gradient(135deg, #f43f5e, #8b5cf6, #3b82f6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.hero .subtitle {
    font-size: 1.1rem;
    color: var(--text2);
    max-width: 700px;
    margin-bottom: 40px;
}
.hero .badge {
    display: inline-block;
    padding: 4px 16px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 16px;
    background: rgba(139,92,246,0.15);
    color: #a78bfa;
    border: 1px solid rgba(139,92,246,0.3);
}

/* Stat counters */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-top: 40px;
}
.stat-card {
    background: rgba(30,41,59,0.6);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 16px;
    padding: 24px;
    text-align: center;
    transition: transform 0.3s;
}
.stat-card:hover { transform: translateY(-4px); }
.stat-card .number {
    font-size: 2.2rem;
    font-weight: 800;
    margin-bottom: 4px;
}
.stat-card .label {
    font-size: 0.85rem;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.stat-card:nth-child(1) .number { color: var(--accent3); }
.stat-card:nth-child(2) .number { color: var(--accent1); }
.stat-card:nth-child(3) .number { color: var(--accent2); }
.stat-card:nth-child(4) .number { color: var(--green); }

/* Finding banner */
.finding-banner {
    background: linear-gradient(135deg, rgba(30,41,59,0.8), rgba(51,65,85,0.4));
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    padding: 32px;
    margin: 40px 0;
    display: flex;
    align-items: center;
    gap: 20px;
}
.finding-icon {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    flex-shrink: 0;
}
.finding-text h3 { font-size: 1.3rem; font-weight: 700; margin-bottom: 4px; }
.finding-text p { color: var(--text2); font-size: 0.9rem; }

/* Section */
section { padding: 40px 0; }
.section-header {
    margin-bottom: 32px;
}
.section-header h2 {
    font-size: 1.6rem;
    font-weight: 700;
    margin-bottom: 8px;
}
.section-header p {
    color: var(--text2);
    font-size: 0.95rem;
}

/* Cards */
.card {
    background: rgba(30,41,59,0.6);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 24px;
}
.card h3 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Grid layouts */
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
.grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px; }

/* Resistance table */
.res-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 4px;
}
.res-table th {
    text-align: left;
    padding: 12px 16px;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text2);
    border-bottom: 1px solid var(--bg3);
}
.res-table td {
    padding: 10px 16px;
    font-size: 0.9rem;
}

/* Species cards */
.species-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
}
.species-card {
    background: rgba(30,41,59,0.5);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 16px;
}

/* COVID panels */
.covid-panel {
    text-align: center;
    padding: 24px;
}
.covid-panel .era-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text2);
    margin-bottom: 16px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Footer */
.footer {
    background: var(--bg2);
    border-top: 1px solid rgba(255,255,255,0.06);
    padding: 48px 0;
    margin-top: 60px;
}
.footer .author { font-size: 1.1rem; font-weight: 600; margin-bottom: 4px; }
.footer .role { color: var(--text2); font-size: 0.9rem; margin-bottom: 12px; }
.footer a { color: var(--accent2); text-decoration: none; }
.footer a:hover { text-decoration: underline; }

/* Legend */
.legend {
    display: flex;
    gap: 24px;
    margin-bottom: 16px;
    flex-wrap: wrap;
}
.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    color: var(--text2);
}
.legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

/* Clinical box */
.clinical-box {
    background: linear-gradient(135deg, rgba(139,92,246,0.08), rgba(59,130,246,0.05));
    border: 1px solid rgba(139,92,246,0.2);
    border-radius: 16px;
    padding: 32px;
}
.clinical-box h3 { color: #a78bfa; }
.clinical-box ul { list-style: none; padding: 0; }
.clinical-box li {
    padding: 8px 0;
    padding-left: 24px;
    position: relative;
    color: var(--text2);
    font-size: 0.95rem;
}
.clinical-box li::before {
    content: '\2192';
    position: absolute;
    left: 0;
    color: var(--accent3);
}

/* Responsive */
@media (max-width: 768px) {
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
    .hero h1 { font-size: 1.8rem; }
    .species-grid { grid-template-columns: 1fr; }
}

/* Animations */
@keyframes countUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.stat-card { animation: countUp 0.6s ease-out backwards; }
.stat-card:nth-child(1) { animation-delay: 0.1s; }
.stat-card:nth-child(2) { animation-delay: 0.2s; }
.stat-card:nth-child(3) { animation-delay: 0.3s; }
.stat-card:nth-child(4) { animation-delay: 0.4s; }
</style>
</head>
<body>

<!-- Hero Section -->
<div class="hero">
    <div class="container hero-content">
        <span class="badge">WHO BPPL 2024 Aligned</span>
        <h1>Shifting Dominance:<br>NFGNB vs Enterobacterales</h1>
        <p class="subtitle">12-Year Surveillance of Respiratory Gram-Negative Infections at a Saudi Tertiary Hospital (2013-2024) — Feasibility Analysis & Trend Dashboard</p>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="number" id="counter-total">9,081</div>
                <div class="label">Total Isolates</div>
            </div>
            <div class="stat-card">
                <div class="number" id="counter-nfgnb">4,011</div>
                <div class="label">NFGNB Isolates</div>
            </div>
            <div class="stat-card">
                <div class="number" id="counter-entero">5,024</div>
                <div class="label">Enterobacterales</div>
            </div>
            <div class="stat-card">
                <div class="number">12</div>
                <div class="label">Years of Data</div>
            </div>
        </div>
    </div>
</div>

<div class="container">

    <!-- Key Finding Banner -->
    <div class="finding-banner">
        <div class="finding-icon" style="background:#22c55e22;color:#22c55e">
            <span class="material-icons-outlined">trending_down</span>
        </div>
        <div class="finding-text">
            <h3>NFGNB proportion is significantly decreasing (-1.542%/year, p=0.0043)</h3>
            <p>Based on linear regression of annual NFGNB proportion over 12 years (R&sup2; = 0.573). NFGNB currently comprises <strong>44.4%</strong> of classified respiratory gram-negative isolates vs <strong>55.6%</strong> for Enterobacterales.</p>
        </div>
    </div>

    <!-- Trend Chart -->
    <section>
        <div class="section-header">
            <h2>Annual Proportion Trends</h2>
            <p>Stacked area chart showing the relative dominance of NFGNB vs Enterobacterales over time</p>
        </div>
        <div class="card">
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background:var(--accent1)"></div>NFGNB</div>
                <div class="legend-item"><div class="legend-dot" style="background:var(--accent2)"></div>Enterobacterales</div>
                <div class="legend-item"><div class="legend-dot" style="background:var(--accent3)"></div>NFGNB Trend Line</div>
            </div>
            <canvas id="trendChart" height="100"></canvas>
        </div>
    </section>

    <!-- Species Emergence -->
    <section>
        <div class="section-header">
            <h2>Species-Level Emergence</h2>
            <p>Individual species trajectories revealing emergence or decline patterns. Asterisk (*) indicates statistically significant trend (p&lt;0.05).</p>
        </div>
        <div class="species-grid">
            
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Acinetobacter baumannii</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#f43f5e22;color:#f43f5e">NFGNB</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=1948 | slope=-15.5/yr *</div>
        <canvas id="sp_Acinetobacter_baumannii" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Pseudomonas aeruginosa</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#f43f5e22;color:#f43f5e">NFGNB</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=1792 | slope=-21.64/yr *</div>
        <canvas id="sp_Pseudomonas_aeruginosa" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Stenotrophomonas maltophilia</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#f43f5e22;color:#f43f5e">NFGNB</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=99 | slope=0.19/yr</div>
        <canvas id="sp_Stenotrophomonas_maltophilia" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Pseudomonas sp.</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#f43f5e22;color:#f43f5e">NFGNB</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=74 | slope=-0.21/yr</div>
        <canvas id="sp_Pseudomonas_sp_" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Burkholderia cepacia</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#f43f5e22;color:#f43f5e">NFGNB</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=36 | slope=0.1/yr</div>
        <canvas id="sp_Burkholderia_cepacia" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Klebsiella pneumoniae</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#3b82f622;color:#3b82f6">Enterobacterales</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=2693 | slope=8.7/yr</div>
        <canvas id="sp_Klebsiella_pneumoniae" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Proteus mirabilis</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#3b82f622;color:#3b82f6">Enterobacterales</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=728 | slope=-13.14/yr *</div>
        <canvas id="sp_Proteus_mirabilis" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Escherichia coli</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#3b82f622;color:#3b82f6">Enterobacterales</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=554 | slope=-4.03/yr *</div>
        <canvas id="sp_Escherichia_coli" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Providencia stuartii</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#3b82f622;color:#3b82f6">Enterobacterales</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=250 | slope=-5.8/yr *</div>
        <canvas id="sp_Providencia_stuartii" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Enterobacter cloacae</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#3b82f622;color:#3b82f6">Enterobacterales</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=196 | slope=-0.13/yr</div>
        <canvas id="sp_Enterobacter_cloacae" height="80"></canvas>
    </div>
    <div class="species-card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-weight:600;font-size:0.95rem"><i>Serratia marcescens</i></span>
            <span style="font-size:0.7rem;padding:2px 8px;border-radius:12px;background:#3b82f622;color:#3b82f6">Enterobacterales</span>
        </div>
        <div style="font-size:0.8rem;color:#94a3b8;margin-bottom:4px">n=148 | slope=-0.92/yr</div>
        <canvas id="sp_Serratia_marcescens" height="80"></canvas>
    </div>
        </div>
    </section>

    <!-- Resistance Heatmap -->
    <section>
        <div class="section-header">
            <h2>Resistance Profile Comparison</h2>
            <p>Head-to-head antibiotic resistance rates: NFGNB vs Enterobacterales. Color-coded by severity: <span style="color:#86efac">&lt;20%</span> | <span style="color:#fde68a">20-39%</span> | <span style="color:#fcd34d">40-69%</span> | <span style="color:#fca5a5">&ge;70%</span></p>
        </div>
        <div class="card" style="overflow-x:auto">
            <table class="res-table">
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Antibiotic</th>
                        <th style="text-align:center;color:var(--accent1)">NFGNB (%R)</th>
                        <th style="text-align:center;color:var(--accent2)">Enterobacterales (%R)</th>
                    </tr>
                </thead>
                <tbody>
                    
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem">Carbapenems</td>
            <td>Imipenem</td>
            <td style="background:rgba(220,38,38,0.25);color:#fca5a5;text-align:center;border-radius:6px;font-weight:600">71.8%<br><span style="font-size:0.7rem;opacity:0.6">n=3616</span></td>
            <td style="background:rgba(251,191,36,0.2);color:#fde68a;text-align:center;border-radius:6px;font-weight:600">24.9%<br><span style="font-size:0.7rem;opacity:0.6">n=4543</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem"></td>
            <td>Meropenem</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">64.9%<br><span style="font-size:0.7rem;opacity:0.6">n=3265</span></td>
            <td style="background:rgba(251,191,36,0.2);color:#fde68a;text-align:center;border-radius:6px;font-weight:600">32.9%<br><span style="font-size:0.7rem;opacity:0.6">n=4473</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem"></td>
            <td>Ertapenem</td>
            <td style="background:rgba(220,38,38,0.25);color:#fca5a5;text-align:center;border-radius:6px;font-weight:600">83.4%<br><span style="font-size:0.7rem;opacity:0.6">n=145</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">44.5%<br><span style="font-size:0.7rem;opacity:0.6">n=2832</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem">Cephalosporins</td>
            <td>Ceftazidime</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">64.6%<br><span style="font-size:0.7rem;opacity:0.6">n=3705</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">63.6%<br><span style="font-size:0.7rem;opacity:0.6">n=4073</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem"></td>
            <td>Cefepime</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">62.3%<br><span style="font-size:0.7rem;opacity:0.6">n=3465</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">57.8%<br><span style="font-size:0.7rem;opacity:0.6">n=4103</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem"></td>
            <td>Ceftriaxone</td>
            <td style="background:rgba(220,38,38,0.25);color:#fca5a5;text-align:center;border-radius:6px;font-weight:600">94.2%<br><span style="font-size:0.7rem;opacity:0.6">n=359</span></td>
            <td style="background:rgba(220,38,38,0.25);color:#fca5a5;text-align:center;border-radius:6px;font-weight:600">71.5%<br><span style="font-size:0.7rem;opacity:0.6">n=752</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem">Fluoroquinolones</td>
            <td>Ciprofloxacin</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">64.9%<br><span style="font-size:0.7rem;opacity:0.6">n=3599</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">66.9%<br><span style="font-size:0.7rem;opacity:0.6">n=4710</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem"></td>
            <td>Levofloxacin</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">57.1%<br><span style="font-size:0.7rem;opacity:0.6">n=2750</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">61.1%<br><span style="font-size:0.7rem;opacity:0.6">n=3592</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem">Aminoglycosides</td>
            <td>Amikacin</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">44.1%<br><span style="font-size:0.7rem;opacity:0.6">n=3146</span></td>
            <td style="background:rgba(251,191,36,0.2);color:#fde68a;text-align:center;border-radius:6px;font-weight:600">37.4%<br><span style="font-size:0.7rem;opacity:0.6">n=4778</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem"></td>
            <td>Gentamicin</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">54.0%<br><span style="font-size:0.7rem;opacity:0.6">n=3674</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">52.4%<br><span style="font-size:0.7rem;opacity:0.6">n=4760</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem"></td>
            <td>Tobramycin</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">45.4%<br><span style="font-size:0.7rem;opacity:0.6">n=2423</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">55.1%<br><span style="font-size:0.7rem;opacity:0.6">n=2935</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem">BL/BLI</td>
            <td>Piperacillin-Tazobactam</td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">46.8%<br><span style="font-size:0.7rem;opacity:0.6">n=2164</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">40.0%<br><span style="font-size:0.7rem;opacity:0.6">n=4372</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem"></td>
            <td>Ampicillin-Sulbactam</td>
            <td style="background:rgba(220,38,38,0.25);color:#fca5a5;text-align:center;border-radius:6px;font-weight:600">74.5%<br><span style="font-size:0.7rem;opacity:0.6">n=823</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">66.5%<br><span style="font-size:0.7rem;opacity:0.6">n=2120</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem">Polymyxins</td>
            <td>Colistin</td>
            <td style="background:rgba(34,197,94,0.2);color:#86efac;text-align:center;border-radius:6px;font-weight:600">4.8%<br><span style="font-size:0.7rem;opacity:0.6">n=2482</span></td>
            <td style="background:rgba(245,158,11,0.25);color:#fcd34d;text-align:center;border-radius:6px;font-weight:600">43.7%<br><span style="font-size:0.7rem;opacity:0.6">n=1473</span></td>
        </tr>
        <tr>
            <td style="color:#94a3b8;font-size:0.85rem">Glycylcyclines</td>
            <td>Tigecycline</td>
            <td style="background:rgba(251,191,36,0.2);color:#fde68a;text-align:center;border-radius:6px;font-weight:600">28.6%<br><span style="font-size:0.7rem;opacity:0.6">n=1229</span></td>
            <td style="background:rgba(34,197,94,0.2);color:#86efac;text-align:center;border-radius:6px;font-weight:600">16.0%<br><span style="font-size:0.7rem;opacity:0.6">n=3198</span></td>
        </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- ICU vs Non-ICU -->
    <section>
        <div class="section-header">
            <h2>ICU vs Non-ICU Distribution</h2>
            <p>Comparing the habitat preference of each group (Chi-square p=0.0106)</p>
        </div>
        <div class="grid-2">
            <div class="card">
                <h3><span style="color:var(--accent1)">&#9679;</span> NFGNB (n=4,011)</h3>
                <canvas id="icuNfgnb" height="200"></canvas>
            </div>
            <div class="card">
                <h3><span style="color:var(--accent2)">&#9679;</span> Enterobacterales (n=5,024)</h3>
                <canvas id="icuEntero" height="200"></canvas>
            </div>
        </div>
    </section>

    <!-- COVID Era -->
    <section>
        <div class="section-header">
            <h2>COVID-19 Era Impact</h2>
            <p>Proportion shift across pre-pandemic, pandemic, and post-pandemic periods</p>
        </div>
        <div class="card">
            <canvas id="covidChart" height="100"></canvas>
        </div>
    </section>

    <!-- DTR -->
    <section>
        <div class="section-header">
            <h2>Difficult-to-Treat Resistance (DTR)</h2>
            <p>Isolates resistant to all first-line agents (carbapenems + fluoroquinolones + extended-spectrum cephalosporins)</p>
        </div>
        <div class="grid-2">
            <div class="card">
                <h3>Overall DTR Rates</h3>
                <canvas id="dtrBar" height="200"></canvas>
            </div>
            <div class="card">
                <h3>DTR Annual Trend</h3>
                <canvas id="dtrTrend" height="200"></canvas>
            </div>
        </div>
    </section>

    <!-- Clinical Implications -->
    <section>
        <div class="clinical-box">
            <h3 style="font-size:1.3rem;margin-bottom:16px">Clinical Implications</h3>
            <ul>
                <li>NFGNB account for <strong>44.4%</strong> of respiratory gram-negative isolates — a substantial burden requiring targeted empiric therapy</li>
                <li>ICU predominance of NFGNB (55.4% ICU) vs Enterobacterales (52.7% ICU) implies different infection acquisition pathways</li>
                <li>DTR rate is dramatically higher in NFGNB (47.2%) compared to Enterobacterales (20.0%), limiting treatment options</li>
                <li>Species-level trends can inform local antibiogram updates and antimicrobial stewardship protocols</li>
                <li>Data supports WHO BPPL 2024 prioritization of <em>A. baumannii</em> and <em>P. aeruginosa</em> as critical-priority pathogens</li>
            </ul>
        </div>
    </section>

</div>

<!-- Footer -->
<div class="footer">
    <div class="container">
        <div class="author">Abdullah M. Algarni, MBBS</div>
        <div class="role">Family Medicine Consultant</div>
        <p style="font-size:0.85rem;color:var(--text2);margin-top:12px">
            <a href="mailto:abaid1406@gmail.com">abaid1406@gmail.com</a> &middot;
            <a href="https://orcid.org/0000-0002-1477-4379" target="_blank">ORCID: 0000-0002-1477-4379</a>
        </p>
        <p style="font-size:0.75rem;color:var(--text2);margin-top:16px;opacity:0.6">
            Paper 8: Shifting Dominance — NFGNB vs Enterobacterales in Respiratory Infections (2013-2024)<br>
            Dashboard generated 2026-02-23 | Data from KAMC-JD Microbiology Laboratory
        </p>
    </div>
</div>

<script>
const DATA = {"overall": {"total_respiratory_gn": 9081, "nfgnb_count": 4011, "entero_count": 5024, "other_count": 46, "nfgnb_pct": 44.4, "entero_pct": 55.6, "study_years": 12, "year_start": 2013, "year_end": 2024}, "annual": [{"year": 2013, "total": 1362, "nfgnb": 680, "entero": 682, "pct_nfgnb": 49.9, "pct_entero": 50.1}, {"year": 2014, "total": 1059, "nfgnb": 556, "entero": 503, "pct_nfgnb": 52.5, "pct_entero": 47.5}, {"year": 2015, "total": 800, "nfgnb": 391, "entero": 409, "pct_nfgnb": 48.9, "pct_entero": 51.1}, {"year": 2016, "total": 791, "nfgnb": 366, "entero": 425, "pct_nfgnb": 46.3, "pct_entero": 53.7}, {"year": 2017, "total": 662, "nfgnb": 350, "entero": 312, "pct_nfgnb": 52.9, "pct_entero": 47.1}, {"year": 2018, "total": 561, "nfgnb": 257, "entero": 304, "pct_nfgnb": 45.8, "pct_entero": 54.2}, {"year": 2019, "total": 750, "nfgnb": 311, "entero": 439, "pct_nfgnb": 41.5, "pct_entero": 58.5}, {"year": 2020, "total": 715, "nfgnb": 234, "entero": 481, "pct_nfgnb": 32.7, "pct_entero": 67.3}, {"year": 2021, "total": 833, "nfgnb": 258, "entero": 575, "pct_nfgnb": 31.0, "pct_entero": 69.0}, {"year": 2022, "total": 661, "nfgnb": 275, "entero": 386, "pct_nfgnb": 41.6, "pct_entero": 58.4}, {"year": 2023, "total": 507, "nfgnb": 213, "entero": 294, "pct_nfgnb": 42.0, "pct_entero": 58.0}, {"year": 2024, "total": 334, "nfgnb": 120, "entero": 214, "pct_nfgnb": 35.9, "pct_entero": 64.1}], "trend": {"slope": -1.542, "intercept": 3155.86, "r_squared": 0.573, "p_value": 0.0043, "direction": "decreasing", "significant": "True"}, "species_nfgnb": [{"species": "Acinetobacter baumannii", "count": 1948}, {"species": "Pseudomonas aeruginosa", "count": 1792}, {"species": "Stenotrophomonas maltophilia", "count": 99}, {"species": "Pseudomonas sp.", "count": 74}, {"species": "Burkholderia cepacia", "count": 36}, {"species": "Acinetobacter lwoffii", "count": 17}], "species_entero": [{"species": "Klebsiella pneumoniae", "count": 2693}, {"species": "Proteus mirabilis", "count": 728}, {"species": "Escherichia coli", "count": 554}, {"species": "Providencia stuartii", "count": 250}, {"species": "Enterobacter cloacae", "count": 196}, {"species": "Serratia marcescens", "count": 148}, {"species": "Klebsiella aerogenes", "count": 128}, {"species": "Morganella morganii", "count": 104}], "species_annual": {"Acinetobacter baumannii": {"data": [{"year": 2013, "count": 223}, {"year": 2014, "count": 269}, {"year": 2015, "count": 219}, {"year": 2016, "count": 178}, {"year": 2017, "count": 194}, {"year": 2018, "count": 137}, {"year": 2019, "count": 177}, {"year": 2020, "count": 142}, {"year": 2021, "count": 126}, {"year": 2022, "count": 147}, {"year": 2023, "count": 87}, {"year": 2024, "count": 49}], "slope": -15.5, "p_value": 0.0, "total": 1948}, "Pseudomonas aeruginosa": {"data": [{"year": 2013, "count": 413}, {"year": 2014, "count": 255}, {"year": 2015, "count": 152}, {"year": 2016, "count": 170}, {"year": 2017, "count": 140}, {"year": 2018, "count": 109}, {"year": 2019, "count": 122}, {"year": 2020, "count": 63}, {"year": 2021, "count": 97}, {"year": 2022, "count": 118}, {"year": 2023, "count": 106}, {"year": 2024, "count": 47}], "slope": -21.64, "p_value": 0.0022, "total": 1792}, "Stenotrophomonas maltophilia": {"data": [{"year": 2013, "count": 12}, {"year": 2014, "count": 6}, {"year": 2015, "count": 3}, {"year": 2016, "count": 6}, {"year": 2017, "count": 6}, {"year": 2018, "count": 4}, {"year": 2019, "count": 9}, {"year": 2020, "count": 19}, {"year": 2021, "count": 16}, {"year": 2022, "count": 5}, {"year": 2023, "count": 6}, {"year": 2024, "count": 7}], "slope": 0.19, "p_value": 0.675, "total": 99}, "Pseudomonas sp.": {"data": [{"year": 2013, "count": 14}, {"year": 2014, "count": 9}, {"year": 2015, "count": 6}, {"year": 2016, "count": 2}, {"year": 2017, "count": 7}, {"year": 2018, "count": 5}, {"year": 2019, "count": 2}, {"year": 2020, "count": 2}, {"year": 2021, "count": 4}, {"year": 2022, "count": 2}, {"year": 2023, "count": 10}, {"year": 2024, "count": 11}], "slope": -0.21, "p_value": 0.5646, "total": 74}, "Burkholderia cepacia": {"data": [{"year": 2013, "count": 5}, {"year": 2014, "count": 2}, {"year": 2015, "count": 0}, {"year": 2016, "count": 5}, {"year": 2017, "count": 0}, {"year": 2018, "count": 0}, {"year": 2019, "count": 0}, {"year": 2020, "count": 8}, {"year": 2021, "count": 11}, {"year": 2022, "count": 1}, {"year": 2023, "count": 1}, {"year": 2024, "count": 3}], "slope": 0.1, "p_value": 0.7447, "total": 36}, "Klebsiella pneumoniae": {"data": [{"year": 2013, "count": 276}, {"year": 2014, "count": 120}, {"year": 2015, "count": 125}, {"year": 2016, "count": 155}, {"year": 2017, "count": 139}, {"year": 2018, "count": 159}, {"year": 2019, "count": 288}, {"year": 2020, "count": 368}, {"year": 2021, "count": 459}, {"year": 2022, "count": 290}, {"year": 2023, "count": 171}, {"year": 2024, "count": 143}], "slope": 8.7, "p_value": 0.3696, "total": 2693}, "Proteus mirabilis": {"data": [{"year": 2013, "count": 141}, {"year": 2014, "count": 114}, {"year": 2015, "count": 99}, {"year": 2016, "count": 134}, {"year": 2017, "count": 78}, {"year": 2018, "count": 47}, {"year": 2019, "count": 39}, {"year": 2020, "count": 25}, {"year": 2021, "count": 18}, {"year": 2022, "count": 22}, {"year": 2023, "count": 8}, {"year": 2024, "count": 3}], "slope": -13.14, "p_value": 0.0, "total": 728}, "Escherichia coli": {"data": [{"year": 2013, "count": 80}, {"year": 2014, "count": 59}, {"year": 2015, "count": 53}, {"year": 2016, "count": 68}, {"year": 2017, "count": 44}, {"year": 2018, "count": 55}, {"year": 2019, "count": 34}, {"year": 2020, "count": 28}, {"year": 2021, "count": 39}, {"year": 2022, "count": 25}, {"year": 2023, "count": 46}, {"year": 2024, "count": 23}], "slope": -4.03, "p_value": 0.001, "total": 554}, "Providencia stuartii": {"data": [{"year": 2013, "count": 50}, {"year": 2014, "count": 87}, {"year": 2015, "count": 51}, {"year": 2016, "count": 13}, {"year": 2017, "count": 4}, {"year": 2018, "count": 11}, {"year": 2019, "count": 15}, {"year": 2020, "count": 6}, {"year": 2021, "count": 4}, {"year": 2022, "count": 8}, {"year": 2023, "count": 1}, {"year": 2024, "count": 0}], "slope": -5.8, "p_value": 0.0033, "total": 250}, "Enterobacter cloacae": {"data": [{"year": 2013, "count": 23}, {"year": 2014, "count": 18}, {"year": 2015, "count": 11}, {"year": 2016, "count": 11}, {"year": 2017, "count": 19}, {"year": 2018, "count": 14}, {"year": 2019, "count": 16}, {"year": 2020, "count": 12}, {"year": 2021, "count": 26}, {"year": 2022, "count": 16}, {"year": 2023, "count": 22}, {"year": 2024, "count": 8}], "slope": -0.13, "p_value": 0.7871, "total": 196}, "Serratia marcescens": {"data": [{"year": 2013, "count": 29}, {"year": 2014, "count": 12}, {"year": 2015, "count": 13}, {"year": 2016, "count": 16}, {"year": 2017, "count": 7}, {"year": 2018, "count": 2}, {"year": 2019, "count": 15}, {"year": 2020, "count": 17}, {"year": 2021, "count": 9}, {"year": 2022, "count": 10}, {"year": 2023, "count": 10}, {"year": 2024, "count": 8}], "slope": -0.92, "p_value": 0.1046, "total": 148}}, "species_groups": {"Acinetobacter baumannii": "NFGNB", "Pseudomonas aeruginosa": "NFGNB", "Stenotrophomonas maltophilia": "NFGNB", "Pseudomonas sp.": "NFGNB", "Burkholderia cepacia": "NFGNB", "Klebsiella pneumoniae": "Enterobacterales", "Proteus mirabilis": "Enterobacterales", "Escherichia coli": "Enterobacterales", "Providencia stuartii": "Enterobacterales", "Enterobacter cloacae": "Enterobacterales", "Serratia marcescens": "Enterobacterales"}, "icu": {"NFGNB": {"icu": 2224, "non_icu": 1787, "icu_pct": 55.4, "non_icu_pct": 44.6}, "Enterobacterales": {"icu": 2649, "non_icu": 2375, "icu_pct": 52.7, "non_icu_pct": 47.3}, "chi2": 6.54, "p_value": 0.0106}, "resistance": {"sir_imi": {"name": "Imipenem", "class": "Carbapenems", "nfgnb_n": 3616, "nfgnb_r": 2598, "nfgnb_r_pct": 71.8, "nfgnb_ns_pct": 74.6, "entero_n": 4543, "entero_r": 1130, "entero_r_pct": 24.9, "entero_ns_pct": 35.1}, "sir_mer": {"name": "Meropenem", "class": "Carbapenems", "nfgnb_n": 3265, "nfgnb_r": 2119, "nfgnb_r_pct": 64.9, "nfgnb_ns_pct": 70.7, "entero_n": 4473, "entero_r": 1473, "entero_r_pct": 32.9, "entero_ns_pct": 35.9}, "sir_ert": {"name": "Ertapenem", "class": "Carbapenems", "nfgnb_n": 145, "nfgnb_r": 121, "nfgnb_r_pct": 83.4, "nfgnb_ns_pct": 84.1, "entero_n": 2832, "entero_r": 1260, "entero_r_pct": 44.5, "entero_ns_pct": 46.9}, "sir_ctz": {"name": "Ceftazidime", "class": "Cephalosporins", "nfgnb_n": 3705, "nfgnb_r": 2393, "nfgnb_r_pct": 64.6, "nfgnb_ns_pct": 68.6, "entero_n": 4073, "entero_r": 2591, "entero_r_pct": 63.6, "entero_ns_pct": 68.2}, "sir_cfp": {"name": "Cefepime", "class": "Cephalosporins", "nfgnb_n": 3465, "nfgnb_r": 2160, "nfgnb_r_pct": 62.3, "nfgnb_ns_pct": 70.1, "entero_n": 4103, "entero_r": 2373, "entero_r_pct": 57.8, "entero_ns_pct": 66.8}, "sir_cfx": {"name": "Ceftriaxone", "class": "Cephalosporins", "nfgnb_n": 359, "nfgnb_r": 338, "nfgnb_r_pct": 94.2, "nfgnb_ns_pct": 95.3, "entero_n": 752, "entero_r": 538, "entero_r_pct": 71.5, "entero_ns_pct": 73.1}, "sir_cip": {"name": "Ciprofloxacin", "class": "Fluoroquinolones", "nfgnb_n": 3599, "nfgnb_r": 2336, "nfgnb_r_pct": 64.9, "nfgnb_ns_pct": 67.5, "entero_n": 4710, "entero_r": 3151, "entero_r_pct": 66.9, "entero_ns_pct": 68.8}, "sir_lev": {"name": "Levofloxacin", "class": "Fluoroquinolones", "nfgnb_n": 2750, "nfgnb_r": 1569, "nfgnb_r_pct": 57.1, "nfgnb_ns_pct": 62.6, "entero_n": 3592, "entero_r": 2194, "entero_r_pct": 61.1, "entero_ns_pct": 64.4}, "sir_amk": {"name": "Amikacin", "class": "Aminoglycosides", "nfgnb_n": 3146, "nfgnb_r": 1386, "nfgnb_r_pct": 44.1, "nfgnb_ns_pct": 48.2, "entero_n": 4778, "entero_r": 1785, "entero_r_pct": 37.4, "entero_ns_pct": 47.4}, "sir_gen": {"name": "Gentamicin", "class": "Aminoglycosides", "nfgnb_n": 3674, "nfgnb_r": 1984, "nfgnb_r_pct": 54.0, "nfgnb_ns_pct": 60.0, "entero_n": 4760, "entero_r": 2492, "entero_r_pct": 52.4, "entero_ns_pct": 54.3}, "sir_tob": {"name": "Tobramycin", "class": "Aminoglycosides", "nfgnb_n": 2423, "nfgnb_r": 1100, "nfgnb_r_pct": 45.4, "nfgnb_ns_pct": 47.4, "entero_n": 2935, "entero_r": 1616, "entero_r_pct": 55.1, "entero_ns_pct": 59.4}, "sir_taz": {"name": "Piperacillin-Tazobactam", "class": "BL/BLI", "nfgnb_n": 2164, "nfgnb_r": 1013, "nfgnb_r_pct": 46.8, "nfgnb_ns_pct": 57.5, "entero_n": 4372, "entero_r": 1748, "entero_r_pct": 40.0, "entero_ns_pct": 45.9}, "sir_sam": {"name": "Ampicillin-Sulbactam", "class": "BL/BLI", "nfgnb_n": 823, "nfgnb_r": 613, "nfgnb_r_pct": 74.5, "nfgnb_ns_pct": 86.5, "entero_n": 2120, "entero_r": 1409, "entero_r_pct": 66.5, "entero_ns_pct": 75.5}, "sir_col": {"name": "Colistin", "class": "Polymyxins", "nfgnb_n": 2482, "nfgnb_r": 119, "nfgnb_r_pct": 4.8, "nfgnb_ns_pct": 6.6, "entero_n": 1473, "entero_r": 643, "entero_r_pct": 43.7, "entero_ns_pct": 47.2}, "sir_tgc": {"name": "Tigecycline", "class": "Glycylcyclines", "nfgnb_n": 1229, "nfgnb_r": 352, "nfgnb_r_pct": 28.6, "nfgnb_ns_pct": 47.1, "entero_n": 3198, "entero_r": 512, "entero_r_pct": 16.0, "entero_ns_pct": 29.4}}, "covid": {"Pre-COVID (2013-2019)": {"total": 5985, "nfgnb": 2911, "entero": 3074, "pct_nfgnb": 48.6, "pct_entero": 51.4}, "Pandemic (2020)": {"total": 715, "nfgnb": 234, "entero": 481, "pct_nfgnb": 32.7, "pct_entero": 67.3}, "Post-COVID (2021-2024)": {"total": 2335, "nfgnb": 866, "entero": 1469, "pct_nfgnb": 37.1, "pct_entero": 62.9}}, "dtr": {"NFGNB": {"n_tested": 3647, "n_dtr": 1721, "rate": 47.2}, "Enterobacterales": {"n_tested": 4339, "n_dtr": 869, "rate": 20.0}}, "dtr_annual": [{"year": 2013, "nfgnb_rate": 35.2, "entero_rate": 6.0, "nfgnb_n": 563, "entero_n": 580}, {"year": 2014, "nfgnb_rate": 45.1, "entero_rate": 7.2, "nfgnb_n": 477, "entero_n": 444}, {"year": 2015, "nfgnb_rate": 58.2, "entero_rate": 8.9, "nfgnb_n": 371, "entero_n": 392}, {"year": 2016, "nfgnb_rate": 47.6, "entero_rate": 8.6, "nfgnb_n": 353, "entero_n": 417}, {"year": 2017, "nfgnb_rate": 56.0, "entero_rate": 13.4, "nfgnb_n": 343, "entero_n": 247}, {"year": 2018, "nfgnb_rate": 51.4, "entero_rate": 10.0, "nfgnb_n": 251, "entero_n": 211}, {"year": 2019, "nfgnb_rate": 56.3, "entero_rate": 16.8, "nfgnb_n": 300, "entero_n": 375}, {"year": 2020, "nfgnb_rate": 62.7, "entero_rate": 31.4, "nfgnb_n": 212, "entero_n": 433}, {"year": 2021, "nfgnb_rate": 41.6, "entero_rate": 52.8, "nfgnb_n": 233, "entero_n": 528}, {"year": 2022, "nfgnb_rate": 46.0, "entero_rate": 39.3, "nfgnb_n": 237, "entero_n": 280}, {"year": 2023, "nfgnb_rate": 31.0, "entero_rate": 22.8, "nfgnb_n": 197, "entero_n": 254}, {"year": 2024, "nfgnb_rate": 30.9, "entero_rate": 17.4, "nfgnb_n": 110, "entero_n": 178}]};

// Chart.js defaults
Chart.defaults.color = '#94a3b8';
Chart.defaults.borderColor = 'rgba(255,255,255,0.06)';
Chart.defaults.font.family = 'Inter';

// ─── Trend Chart (Stacked Area) ─────────────────────────────
(() => {
    const ctx = document.getElementById('trendChart').getContext('2d');
    const years = DATA.annual.map(d => d.year);
    const nfgnbPct = DATA.annual.map(d => d.pct_nfgnb);
    const enteroPct = DATA.annual.map(d => d.pct_entero);

    // Trend line
    const trendLine = years.map(y => DATA.trend.intercept + DATA.trend.slope * y);

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: years,
            datasets: [
                {
                    label: 'NFGNB %',
                    data: nfgnbPct,
                    backgroundColor: 'rgba(244,63,94,0.15)',
                    borderColor: '#f43f5e',
                    borderWidth: 2.5,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#f43f5e',
                },
                {
                    label: 'Enterobacterales %',
                    data: enteroPct,
                    backgroundColor: 'rgba(59,130,246,0.15)',
                    borderColor: '#3b82f6',
                    borderWidth: 2.5,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#3b82f6',
                },
                {
                    label: 'NFGNB Trend',
                    data: trendLine,
                    borderColor: '#8b5cf6',
                    borderWidth: 2,
                    borderDash: [8, 4],
                    fill: false,
                    pointRadius: 0,
                }
            ]
        },
        options: {
            responsive: true,
            interaction: { intersect: false, mode: 'index' },
            plugins: {
                tooltip: {
                    backgroundColor: '#1e293b',
                    titleColor: '#e2e8f0',
                    bodyColor: '#94a3b8',
                    borderColor: 'rgba(255,255,255,0.1)',
                    borderWidth: 1,
                    padding: 12,
                    callbacks: {
                        afterBody: function(items) {
                            const idx = items[0].dataIndex;
                            const d = DATA.annual[idx];
                            return `\nTotal: ${d.total} isolates\nNFGNB: ${d.nfgnb} | Entero: ${d.entero}`;
                        }
                    }
                },
                legend: { display: false }
            },
            scales: {
                y: {
                    min: 0,
                    max: 100,
                    ticks: { callback: v => v + '%' },
                    title: { display: true, text: 'Proportion (%)' }
                },
                x: {
                    title: { display: true, text: 'Year' }
                }
            }
        }
    });
})();

// ─── Species Sparklines ─────────────────────────────────────
(() => {
    const years = DATA.annual.map(d => d.year);
    for (const [sp, info] of Object.entries(DATA.species_annual)) {
        const canvasId = 'sp_' + sp.replace(/ /g, '_').replace(/\./g, '_');
        const el = document.getElementById(canvasId);
        if (!el) continue;
        const ctx = el.getContext('2d');
        const grp = DATA.species_groups[sp] || 'Unknown';
        const color = grp === 'NFGNB' ? '#f43f5e' : '#3b82f6';

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: years,
                datasets: [{
                    data: info.data.map(d => d.count),
                    borderColor: color,
                    backgroundColor: color + '20',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    pointBackgroundColor: color,
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1e293b', padding: 8 } },
                scales: {
                    y: { display: false, beginAtZero: true },
                    x: { display: false }
                }
            }
        });
    }
})();

// ─── ICU Donut Charts ───────────────────────────────────────
(() => {
    function makeDonut(id, icuPct, nonIcuPct, color) {
        const ctx = document.getElementById(id).getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['ICU', 'Non-ICU'],
                datasets: [{
                    data: [icuPct, nonIcuPct],
                    backgroundColor: [color, color + '33'],
                    borderColor: ['transparent', 'transparent'],
                    borderWidth: 0,
                }]
            },
            options: {
                responsive: true,
                cutout: '65%',
                plugins: {
                    legend: { position: 'bottom', labels: { padding: 16 } },
                    tooltip: { callbacks: { label: item => item.label + ': ' + item.raw + '%' } }
                }
            }
        });
    }
    makeDonut('icuNfgnb', 55.4, 44.6, '#f43f5e');
    makeDonut('icuEntero', 52.7, 47.3, '#3b82f6');
})();

// ─── COVID Era Chart ────────────────────────────────────────
(() => {
    const ctx = document.getElementById('covidChart').getContext('2d');
    const eras = Object.keys(DATA.covid);
    const nfgnbPcts = eras.map(e => DATA.covid[e].pct_nfgnb);
    const enteroPcts = eras.map(e => DATA.covid[e].pct_entero);
    const totals = eras.map(e => DATA.covid[e].total);

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: eras.map((e, i) => e + ' (n=' + totals[i] + ')'),
            datasets: [
                {
                    label: 'NFGNB %',
                    data: nfgnbPcts,
                    backgroundColor: '#f43f5e',
                    borderRadius: 6,
                    barPercentage: 0.6,
                },
                {
                    label: 'Enterobacterales %',
                    data: enteroPcts,
                    backgroundColor: '#3b82f6',
                    borderRadius: 6,
                    barPercentage: 0.6,
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                tooltip: { callbacks: { label: item => item.dataset.label + ': ' + item.raw + '%' } }
            },
            scales: {
                y: { min: 0, max: 100, ticks: { callback: v => v + '%' }, title: { display: true, text: 'Proportion (%)' } },
            }
        }
    });
})();

// ─── DTR Bar Chart ──────────────────────────────────────────
(() => {
    const ctx = document.getElementById('dtrBar').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['NFGNB', 'Enterobacterales'],
            datasets: [{
                label: 'DTR Rate (%)',
                data: [DATA.dtr.NFGNB.rate, DATA.dtr.Enterobacterales.rate],
                backgroundColor: ['#f43f5e', '#3b82f6'],
                borderRadius: 8,
                barPercentage: 0.5,
            }]
        },
        options: {
            responsive: true,
            indexAxis: 'y',
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        afterLabel: function(item) {
                            const grp = item.label;
                            const d = DATA.dtr[grp];
                            return `${d.n_dtr} / ${d.n_tested} isolates`;
                        }
                    }
                }
            },
            scales: {
                x: { min: 0, ticks: { callback: v => v + '%' }, title: { display: true, text: 'DTR Rate (%)' } },
            }
        }
    });
})();

// ─── DTR Trend Chart ────────────────────────────────────────
(() => {
    const ctx = document.getElementById('dtrTrend').getContext('2d');
    const years = DATA.dtr_annual.map(d => d.year);
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: years,
            datasets: [
                {
                    label: 'NFGNB DTR %',
                    data: DATA.dtr_annual.map(d => d.nfgnb_rate),
                    borderColor: '#f43f5e',
                    backgroundColor: 'rgba(244,63,94,0.1)',
                    borderWidth: 2.5,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: '#f43f5e',
                },
                {
                    label: 'Enterobacterales DTR %',
                    data: DATA.dtr_annual.map(d => d.entero_rate),
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59,130,246,0.1)',
                    borderWidth: 2.5,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: '#3b82f6',
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                tooltip: {
                    callbacks: {
                        afterLabel: function(item) {
                            const d = DATA.dtr_annual[item.dataIndex];
                            const n = item.datasetIndex === 0 ? d.nfgnb_n : d.entero_n;
                            return `n=${n} tested`;
                        }
                    }
                }
            },
            scales: {
                y: { min: 0, ticks: { callback: v => v + '%' }, title: { display: true, text: 'DTR Rate (%)' } },
                x: { title: { display: true, text: 'Year' } }
            }
        }
    });
})();

// ─── Animated Counters ──────────────────────────────────────
function animateCounter(id, target) {
    const el = document.getElementById(id);
    if (!el) return;
    let current = 0;
    const step = Math.max(1, Math.floor(target / 60));
    const timer = setInterval(() => {
        current += step;
        if (current >= target) {
            current = target;
            clearInterval(timer);
        }
        el.textContent = current.toLocaleString();
    }, 16);
}

// Trigger counters on load
window.addEventListener('load', () => {
    animateCounter('counter-total', 9081);
    animateCounter('counter-nfgnb', 4011);
    animateCounter('counter-entero', 5024);
});
</script>

</body>
</html>